
> homegarden-api@2.0.0 test:coverage
> vitest run --coverage --no-file-parallelism


[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90m/Users/samueldulex/git/archiOweb-api[39m
      [2mCoverage enabled with [22m[33mv8[39m

[90mstdout[2m | tests/integration/body-limit.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstderr[2m | tests/integration/body-limit.test.ts[2m > [22m[2mRoute Body Limits[2m > [22m[2mshould return 413 when dr-plant payload is too large
[22m[39mError: Context is not finalized. Did you forget to return a Response object or `await next()`?
    at [90mfile:///Users/samueldulex/git/archiOweb-api/[39mnode_modules/[4mhono[24m/dist/hono-base.js:303:17
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at [90m/Users/samueldulex/git/archiOweb-api/[39mtests/integration/body-limit.test.ts:17:17
    at [90mfile:///Users/samueldulex/git/archiOweb-api/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

 [31mâ¯[39m tests/integration/body-limit.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 36[2mms[22m[39m
[31m     [31mÃ—[31m should return 413 when dr-plant payload is too large[39m[32m 21[2mms[22m[39m
[31m     [31mÃ—[31m should return 413 when plant-id payload is too large[39m[32m 14[2mms[22m[39m
[90mstdout[2m | tests/middleware/auth.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

{"level":40,"time":1766359299755,"err":{"type":"Object","message":"Invalid token","stack":""},"msg":"Auth failed"}
{"level":50,"time":1766359299758,"err":{"type":"Error","message":"Database connection not initialized","stack":"Error: Database connection not initialized\n    at /Users/samueldulex/git/archiOweb-api/infrastructure/http/middleware/auth.middleware.ts:59:13\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at /Users/samueldulex/git/archiOweb-api/tests/middleware/auth.middleware.test.ts:172:21\n    at file:///Users/samueldulex/git/archiOweb-api/node_modules/@vitest/runner/dist/index.js:915:20"},"msg":"AuthMiddleware Error"}
{"level":50,"time":1766359299757,"err":{"type":"Error","message":"Supabase URL or Publishable Key not configured","stack":"Error: Supabase URL or Publishable Key not configured\n    at getSupabase (/Users/samueldulex/git/archiOweb-api/infrastructure/http/middleware/auth.middleware.ts:11:11)\n    at Module.<anonymous> (/Users/samueldulex/git/archiOweb-api/infrastructure/http/middleware/auth.middleware.ts:38:22)\n    at /Users/samueldulex/git/archiOweb-api/tests/middleware/auth.middleware.test.ts:147:27\n    at file:///Users/samueldulex/git/archiOweb-api/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///Users/samueldulex/git/archiOweb-api/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///Users/samueldulex/git/archiOweb-api/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/samueldulex/git/archiOweb-api/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///Users/samueldulex/git/archiOweb-api/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///Users/samueldulex/git/archiOweb-api/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)"},"msg":"AuthMiddleware Error"}
 [31mâ¯[39m tests/middleware/auth.middleware.test.ts [2m([22m[2m7 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[32m 4[2mms[22m[39m
     [32mâœ“[39m should return 401 if Authorization header is missing[32m 1[2mms[22m[39m
     [32mâœ“[39m should return 401 if token is invalid or Supabase returns error[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m should sync existing user and call next()[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m should create and sync new user if not in database[39m[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should handle metadata without full_name[39m[32m 0[2mms[22m[39m
     [32mâœ“[39m should return 500 if environment variables are missing[32m 0[2mms[22m[39m
     [32mâœ“[39m should return 500 if prisma is missing[32m 1[2mms[22m[39m
[90mstdout[2m | tests/infrastructure/config/logger.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

 [31mâ¯[39m tests/infrastructure/config/logger.test.ts [2m([22m[2m3 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 10[2mms[22m[39m
[31m     [31mÃ—[31m should create logger with development config when NODE_ENV is development[39m[32m 9[2mms[22m[39m
[31m     [31mÃ—[31m should create logger with production config when NODE_ENV is production[39m[32m 1[2mms[22m[39m
     [32mâœ“[39m should be silent in test env[32m 0[2mms[22m[39m
[90mstdout[2m | tests/adapters/gemini-plant.adapter.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [31mâ¯[39m tests/adapters/gemini-plant.adapter.test.ts [2m([22m[2m29 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 7[2mms[22m[39m
       [32mâœ“[39m should identify a species successfully[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle identification failure response[32m 0[2mms[22m[39m
       [32mâœ“[39m should handle API errors[32m 0[2mms[22m[39m
       [32mâœ“[39m should return error if no API key is set[32m 0[2mms[22m[39m
       [32mâœ“[39m should handle markdown wrapped JSON response[32m 0[2mms[22m[39m
       [32mâœ“[39m should handle plain markdown wrapped JSON response[32m 0[2mms[22m[39m
       [32mâœ“[39m should handle invalid JSON response[32m 0[2mms[22m[39m
       [32mâœ“[39m should identify from image URL[32m 1[2mms[22m[39m
       [32mâœ“[39m should identify with location context[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle fetch errors for image URL[32m 0[2mms[22m[39m
       [32mâœ“[39m should throw error for unsafe image URL[32m 0[2mms[22m[39m
       [32mâœ“[39m should diagnose health successfully[32m 0[2mms[22m[39m
       [32mâœ“[39m should use default empty arrays for symptoms and causes if missing from AI response[32m 0[2mms[22m[39m
       [32mâœ“[39m should diagnose health with all optional fields[32m 0[2mms[22m[39m
       [32mâœ“[39m should handle diagnosis failure response[32m 0[2mms[22m[39m
       [32mâœ“[39m should handle diagnosis error exception[32m 0[2mms[22m[39m
       [32mâœ“[39m should return error if no API key is set for diagnosis[32m 0[2mms[22m[39m
       [32mâœ“[39m should construct prompt with full care and environment details[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should handle unparseable JSON error from AI[39m[32m 2[2mms[22m[39m
       [32mâœ“[39m should handle non-Error exceptions[32m 0[2mms[22m[39m
       [32mâœ“[39m should return true if API responds[32m 0[2mms[22m[39m
       [32mâœ“[39m should return false if API fails[32m 0[2mms[22m[39m
       [32mâœ“[39m should return false if API key is missing[32m 0[2mms[22m[39m
       [32mâœ“[39m should return model names[32m 0[2mms[22m[39m
       [32mâœ“[39m getGeminiPlantAdapter stays a singleton[32m 0[2mms[22m[39m
       [32mâœ“[39m should coerce invalid condition type to DISEASE[32m 0[2mms[22m[39m
       [32mâœ“[39m should coerce invalid severity to MODERATE[32m 0[2mms[22m[39m
       [32mâœ“[39m should use default mimeType in buildImagePart if not provided[32m 0[2mms[22m[39m
       [32mâœ“[39m should use default mimeType if content-type header is missing from fetch[32m 0[2mms[22m[39m
[90mstdout[2m | tests/controllers/garden.controller.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/domain/services/password.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

 [32mâœ“[39m tests/domain/services/password.service.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 337[2mms[22m[39m
[90mstdout[2m | tests/e2e/auth.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

 [32mâœ“[39m tests/e2e/auth.e2e.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 31[2mms[22m[39m
[90mstdout[2m | tests/e2e/health.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mâœ“[39m tests/e2e/health.e2e.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 29[2mms[22m[39m
[90mstdout[2m | tests/e2e/garden.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

 [32mâœ“[39m tests/e2e/garden.e2e.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 27[2mms[22m[39m
[90mstdout[2m | tests/integration/dr-plant.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

 [32mâœ“[39m tests/integration/dr-plant.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 15[2mms[22m[39m
[90mstdout[2m | tests/middleware/validation.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

 [32mâœ“[39m tests/middleware/validation.middleware.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 13[2mms[22m[39m
[90mstdout[2m | infrastructure/http/routes/plant-id.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

 [32mâœ“[39m infrastructure/http/routes/plant-id.routes.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 25[2mms[22m[39m
[90mstdout[2m | tests/integration/garden.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

 [32mâœ“[39m tests/integration/garden.routes.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 8[2mms[22m[39m
[90mstdout[2m | tests/adapters/open-meteo.adapter.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

 [32mâœ“[39m tests/adapters/open-meteo.adapter.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 5[2mms[22m[39m
[90mstdout[2m | tests/integration/user-profile.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/integration/user-profile.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 8[2mms[22m[39m
[90mstdout[2m | tests/integration/plant.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/integration/plant.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 7[2mms[22m[39m
[90mstdout[2m | tests/integration/dr-plant.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

 [32mâœ“[39m tests/integration/dr-plant.integration.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 15[2mms[22m[39m
[90mstdout[2m | tests/integration/nearby-gardens.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/integration/nearby-gardens.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 7[2mms[22m[39m
[90mstdout[2m | tests/repositories/garden-prisma.repository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

 [32mâœ“[39m tests/repositories/garden-prisma.repository.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 3[2mms[22m[39m
[90mstdout[2m | tests/middleware/compression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mâœ“[39m tests/middleware/compression.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 11[2mms[22m[39m
[90mstdout[2m | tests/middleware/logger.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

 [32mâœ“[39m tests/middleware/logger.middleware.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 10[2mms[22m[39m
[90mstdout[2m | tests/repositories/user-prisma.repository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mâœ“[39m tests/repositories/user-prisma.repository.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 3[2mms[22m[39m
[90mstdout[2m | tests/use-cases/diagnose-plant.use-case.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

 [32mâœ“[39m tests/use-cases/diagnose-plant.use-case.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 3[2mms[22m[39m
[90mstdout[2m | tests/websocket/weather.handler.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/websocket/weather.handler.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 7[2mms[22m[39m
[90mstdout[2m | tests/auth.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

 [32mâœ“[39m tests/auth.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 8[2mms[22m[39m
[90mstdout[2m | tests/integration/weather.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

 [32mâœ“[39m tests/integration/weather.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 7[2mms[22m[39m
[90mstdout[2m | tests/repositories/plant-prisma.repository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

 [32mâœ“[39m tests/repositories/plant-prisma.repository.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 4[2mms[22m[39m
[90mstdout[2m | tests/websocket/care-reminder.handler.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/websocket/care-reminder.handler.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 6[2mms[22m[39m
[90mstdout[2m | tests/application/services/TokenService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

 [32mâœ“[39m tests/application/services/TokenService.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 4[2mms[22m[39m
[90mstdout[2m | tests/domain/plant.entity.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

 [32mâœ“[39m tests/domain/plant.entity.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 3[2mms[22m[39m
[90mstdout[2m | tests/use-cases/add-plant.use-case.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

 [32mâœ“[39m tests/use-cases/add-plant.use-case.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 3[2mms[22m[39m
[90mstdout[2m | tests/use-cases/identify-species.use-case.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/use-cases/identify-species.use-case.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 3[2mms[22m[39m
[90mstdout[2m | tests/controllers/dr-plant.controller.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mâœ“[39m tests/controllers/dr-plant.controller.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 4[2mms[22m[39m
[90mstdout[2m | tests/domain/garden.entity.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

 [32mâœ“[39m tests/domain/garden.entity.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/use-cases/find-nearby-gardens.use-case.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

 [32mâœ“[39m tests/use-cases/find-nearby-gardens.use-case.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 3[2mms[22m[39m
[90mstdout[2m | tests/middleware/rate-limit.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

 [32mâœ“[39m tests/middleware/rate-limit.middleware.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 3[2mms[22m[39m
[90mstdout[2m | tests/controllers/plant-id.controller.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

 [32mâœ“[39m tests/controllers/plant-id.controller.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 3[2mms[22m[39m
[90mstdout[2m | tests/use-cases/get-user-plants.use-case.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

 [32mâœ“[39m tests/use-cases/get-user-plants.use-case.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/controllers/user.controller.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

 [32mâœ“[39m tests/controllers/user.controller.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/domain/care-schedule.entity.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

 [32mâœ“[39m tests/domain/care-schedule.entity.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/domain/services/authorization.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

 [32mâœ“[39m tests/domain/services/authorization.service.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 1[2mms[22m[39m
[90mstdout[2m | tests/shared/utils/date.utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

 [32mâœ“[39m tests/shared/utils/date.utils.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/middleware/error-handler.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

 [32mâœ“[39m tests/middleware/error-handler.middleware.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/controllers/auth.controller.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

 [32mâœ“[39m tests/controllers/auth.controller.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 1[2mms[22m[39m
[90mstdout[2m | tests/use-cases/get-garden-weather.use-case.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

 [32mâœ“[39m tests/use-cases/get-garden-weather.use-case.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/controllers/plant.controller.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mâœ“[39m tests/controllers/plant.controller.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 1[2mms[22m[39m
[90mstdout[2m | tests/domain/value-objects/email.vo.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

 [32mâœ“[39m tests/domain/value-objects/email.vo.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 1[2mms[22m[39m
[90mstdout[2m | tests/domain/user.entity.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

 [32mâœ“[39m tests/domain/user.entity.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/domain/diagnosis.entity.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

 [32mâœ“[39m tests/domain/diagnosis.entity.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/controllers/care-tracker.controller.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

 [32mâœ“[39m tests/controllers/care-tracker.controller.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 1[2mms[22m[39m
[90mstdout[2m | tests/shared/utils/ssrf.validator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/shared/utils/ssrf.validator.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/shared/errors/app-error.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

 [32mâœ“[39m tests/shared/errors/app-error.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 1[2mms[22m[39m
[90mstdout[2m | tests/domain/species.entity.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/domain/species.entity.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/shared/utils/geo.utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

 [32mâœ“[39m tests/shared/utils/geo.utils.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 1[2mms[22m[39m
[90mstdout[2m | tests/domain/value-objects/geo-location.vo.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

 [32mâœ“[39m tests/domain/value-objects/geo-location.vo.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 1[2mms[22m[39m
[90mstdout[2m | tests/domain/value-objects/plant-exposure.vo.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

 [32mâœ“[39m tests/domain/value-objects/plant-exposure.vo.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 1[2mms[22m[39m
[90mstdout[2m | tests/smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/smoke.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 1[2mms[22m[39m
[90mstdout[2m | tests/domain/value-objects/password.vo.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/domain/value-objects/password.vo.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 1[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Suites 1 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m tests/controllers/garden.controller.test.ts[2m [ tests/controllers/garden.controller.test.ts ][22m
[31m[1mError[22m: Transform failed with 1 error:
/Users/samueldulex/git/archiOweb-api/tests/controllers/garden.controller.test.ts:103:22: ERROR: "await" can only be used inside an "async" function[39m
  Plugin: [35mvite:esbuild[39m
  File: [36m/Users/samueldulex/git/archiOweb-api/tests/controllers/garden.controller.test.ts[39m:103:22
[33m  
  "await" can only be used inside an "async" function
  101 |        mockContext.get.mockReturnValue({ id: 'u1' })
  102 |        mockGetPlants.execute.mockResolvedValue(fail(new Error('Failed')))
  103 |        const result = (await controller.getPlants(mockContext)) as any
      |                        ^
  104 |        expect(result.status).toBe(500)
  105 |      })
  [39m
[90m [2mâ¯[22m failureErrorWithLog node_modules/esbuild/lib/main.js:[2m1467:15[22m[39m
[90m [2mâ¯[22m node_modules/esbuild/lib/main.js:[2m736:50[22m[39m
[90m [2mâ¯[22m responseCallbacks.<computed> node_modules/esbuild/lib/main.js:[2m603:9[22m[39m
[90m [2mâ¯[22m handleIncomingPacket node_modules/esbuild/lib/main.js:[2m658:12[22m[39m
[90m [2mâ¯[22m Socket.readFromStdout node_modules/esbuild/lib/main.js:[2m581:7[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/9]â¯[22m[39m


[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 8 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m tests/adapters/gemini-plant.adapter.test.ts[2m > [22mGeminiPlantAdapter[2m > [22mdiagnoseHealth[2m > [22mshould handle unparseable JSON error from AI
[31m[1mAssertionError[22m: expected 'Invalid AI response format' to contain 'Failed to parse diagnosis'[39m

Expected: [32m"Failed to parse diagnosis"[39m
Received: [31m"Invalid AI response format"[39m

[36m [2mâ¯[22m tests/adapters/gemini-plant.adapter.test.ts:[2m451:29[22m[39m
    [90m449| [39m       const result = await adapter.diagnoseHealth({ image: 'data', isâ€¦
    [90m450| [39m       [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)
    [90m451| [39m       [34mexpect[39m(result[33m.[39merror)[33m.[39m[34mtoContain[39m([32m'Failed to parse diagnosis'[39m)
    [90m   | [39m                            [31m^[39m
    [90m452| [39m    })
    [90m453| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/9]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/body-limit.test.ts[2m > [22mRoute Body Limits[2m > [22mshould return 413 when dr-plant payload is too large
[31m[1mAssertionError[22m: expected 500 to be 413 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 413[39m
[31m+ 500[39m

[36m [2mâ¯[22m tests/integration/body-limit.test.ts:[2m22:24[22m[39m
    [90m 20| [39m    })
    [90m 21| [39m
    [90m 22| [39m    [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m413[39m)
    [90m   | [39m                       [31m^[39m
    [90m 23| [39m    [35mconst[39m json [33m=[39m [35mawait[39m res[33m.[39m[34mjson[39m()
    [90m 24| [39m    [34mexpect[39m(json[33m.[39merror)[33m.[39m[34mtoBe[39m([32m'PAYLOAD_TOO_LARGE'[39m)

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/9]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/body-limit.test.ts[2m > [22mRoute Body Limits[2m > [22mshould return 413 when plant-id payload is too large
[31m[1mAssertionError[22m: expected 400 to be 413 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 413[39m
[31m+ 400[39m

[36m [2mâ¯[22m tests/integration/body-limit.test.ts:[2m46:25[22m[39m
    [90m 44| [39m     })
    [90m 45| [39m 
    [90m 46| [39m     [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m413[39m)
    [90m   | [39m                        [31m^[39m
    [90m 47| [39m     [35mconst[39m json [33m=[39m [35mawait[39m res[33m.[39m[34mjson[39m()
    [90m 48| [39m     [34mexpect[39m(json[33m.[39merror)[33m.[39m[34mtoBe[39m([32m'PAYLOAD_TOO_LARGE'[39m)

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/9]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/middleware/auth.middleware.test.ts[2m > [22mAuthMiddleware[2m > [22mshould sync existing user and call next()
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'user')[39m
[36m [2mâ¯[22m tests/middleware/auth.middleware.test.ts:[2m83:22[22m[39m
    [90m 81| [39m
    [90m 82| [39m    [35mconst[39m dbUser [33m=[39m { id[33m:[39m [32m'db-id'[39m[33m,[39m email[33m:[39m [32m'test@example.com'[39m }
    [90m 83| [39m    vi[33m.[39m[34mmocked[39m(prisma[33m.[39muser[33m.[39mfindUnique)[33m.[39m[34mmockResolvedValue[39m(dbUser [35mas[39m any)
    [90m   | [39m                     [31m^[39m
    [90m 84| [39m
    [90m 85| [39m    [35mawait[39m [34mauthMiddleware[39m(mockContext[33m,[39m mockNext)

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/9]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/middleware/auth.middleware.test.ts[2m > [22mAuthMiddleware[2m > [22mshould create and sync new user if not in database
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'user')[39m
[36m [2mâ¯[22m tests/middleware/auth.middleware.test.ts:[2m101:22[22m[39m
    [90m 99| [39m    mockSupabase.auth.getUser.mockResolvedValue({ data: { user: mockUsâ€¦
    [90m100| [39m
    [90m101| [39m    vi[33m.[39m[34mmocked[39m(prisma[33m.[39muser[33m.[39mfindUnique)[33m.[39m[34mmockResolvedValue[39m([35mnull[39m)
    [90m   | [39m                     [31m^[39m
    [90m102| [39m    [35mconst[39m createdUser [33m=[39m { id[33m:[39m [32m'new-db-id'[39m[33m,[39m email[33m:[39m [32m'new@example.com'[39m }
    [90m103| [39m    vi[33m.[39m[34mmocked[39m(prisma[33m.[39muser[33m.[39mcreate)[33m.[39m[34mmockResolvedValue[39m(createdUser [35mas[39m any)

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/9]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/middleware/auth.middleware.test.ts[2m > [22mAuthMiddleware[2m > [22mshould handle metadata without full_name
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'user')[39m
[36m [2mâ¯[22m tests/middleware/auth.middleware.test.ts:[2m126:22[22m[39m
    [90m124| [39m      error[33m:[39m [35mnull[39m[33m,[39m
    [90m125| [39m    })
    [90m126| [39m    vi[33m.[39m[34mmocked[39m(prisma[33m.[39muser[33m.[39mfindUnique)[33m.[39m[34mmockResolvedValue[39m([35mnull[39m)
    [90m   | [39m                     [31m^[39m
    [90m127| [39m    vi.mocked(prisma.user.create).mockResolvedValue({ id: 'id' } as anâ€¦
    [90m128| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/9]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/infrastructure/config/logger.test.ts[2m > [22mLogger Config[2m > [22mshould create logger with development config when NODE_ENV is development
[31m[1mAssertionError[22m: expected 'silent' to be 'info' // Object.is equality[39m

Expected: [32m"info"[39m
Received: [31m"silent"[39m

[36m [2mâ¯[22m tests/infrastructure/config/logger.test.ts:[2m13:26[22m[39m
    [90m 11| [39m    
    [90m 12| [39m    [34mexpect[39m(logger)[33m.[39m[34mtoBeDefined[39m()
    [90m 13| [39m    [34mexpect[39m(logger[33m.[39mlevel)[33m.[39m[34mtoBe[39m([32m'info'[39m)
    [90m   | [39m                         [31m^[39m
    [90m 14| [39m  })
    [90m 15| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/9]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/infrastructure/config/logger.test.ts[2m > [22mLogger Config[2m > [22mshould create logger with production config when NODE_ENV is production
[31m[1mAssertionError[22m: expected 'silent' to be 'info' // Object.is equality[39m

Expected: [32m"info"[39m
Received: [31m"silent"[39m

[36m [2mâ¯[22m tests/infrastructure/config/logger.test.ts:[2m24:26[22m[39m
    [90m 22| [39m    const { logger } = await import('../../../infrastructure/config/loâ€¦
    [90m 23| [39m    [34mexpect[39m(logger)[33m.[39m[34mtoBeDefined[39m()
    [90m 24| [39m    [34mexpect[39m(logger[33m.[39mlevel)[33m.[39m[34mtoBe[39m([32m'info'[39m)
    [90m   | [39m                         [31m^[39m
    [90m 25| [39m  })
    [90m 26| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/9]â¯[22m[39m


[2m Test Files [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m53 passed[39m[22m[90m (58)[39m
[2m      Tests [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m351 passed[39m[22m[90m (359)[39m
[2m   Start at [22m 18:21:39
[2m   Duration [22m 5.98s[2m (transform 312ms, setup 376ms, import 1.41s, tests 709ms, environment 2ms)[22m

