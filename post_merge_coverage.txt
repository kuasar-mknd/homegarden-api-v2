
> homegarden-api@2.0.0 test:coverage
> vitest run --coverage --no-file-parallelism


[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90m/Users/samueldulex/git/archiOweb-api[39m
      [2mCoverage enabled with [22m[33mv8[39m

[90mstdout[2m | tests/integration/user-profile.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

 [31mâ¯[39m tests/integration/user-profile.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[32m 13[2mms[22m[39m
[31m     [31mÃ—[31m should return public profile for existing user[39m[32m 9[2mms[22m[39m
[31m     [31mÃ—[31m should return 404 for non-existent user[39m[32m 1[2mms[22m[39m
     [32mâœ“[39m should return 401 if not authenticated[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should return null for avatarUrl if not set[39m[32m 1[2mms[22m[39m
[90mstdout[2m | tests/e2e/garden.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

 [31mâ¯[39m tests/e2e/garden.e2e.test.ts [2m([22m[2m7 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 68[2mms[22m[39m
       [32mâœ“[39m should return empty plants list for user[32m 29[2mms[22m[39m
       [32mâœ“[39m should find nearby gardens[32m 9[2mms[22m[39m
       [32mâœ“[39m should return 400 for missing coordinates[32m 6[2mms[22m[39m
[31m       [31mÃ—[31m should return weather for garden location[39m[32m 9[2mms[22m[39m
[31m       [31mÃ—[31m should return 404 for non-existent garden[39m[32m 6[2mms[22m[39m
       [32mâœ“[39m should add a plant to garden[32m 3[2mms[22m[39m
       [32mâœ“[39m should return 404 for non-existent garden[32m 4[2mms[22m[39m
[90mstdout[2m | tests/smoke.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

 [32mâœ“[39m tests/smoke.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 3[2mms[22m[39m
[90mstdout[2m | tests/e2e/health.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/e2e/health.e2e.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 151[2mms[22m[39m
[90mstdout[2m | tests/e2e/auth.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

 [32mâœ“[39m tests/e2e/auth.e2e.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 80[2mms[22m[39m
[90mstdout[2m | tests/integration/weather.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

 [31mâ¯[39m tests/integration/weather.test.ts [2m([22m[2m3 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 34[2mms[22m[39m
     [32mâœ“[39m should return 401 if not authenticated[32m 17[2mms[22m[39m
[31m     [31mÃ—[31m should return weather data for valid garden[39m[32m 6[2mms[22m[39m
[31m     [31mÃ—[31m should return 400 for invalid garden ID format[39m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/controllers/garden.controller.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

 [31mâ¯[39m tests/controllers/garden.controller.test.ts [2m([22m[2m21 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 116[2mms[22m[39m
       [32mâœ“[39m should add plant successfully[32m 3[2mms[22m[39m
       [32mâœ“[39m should return 401 if unauthorized[32m 0[2mms[22m[39m
       [32mâœ“[39m should handle use case error[32m 0[2mms[22m[39m
       [32mâœ“[39m should handle generic error[32m 0[2mms[22m[39m
       [32mâœ“[39m should return 200 and plants list[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle use case failure[32m 0[2mms[22m[39m
       [32mâœ“[39m should handle use case failure with generic error (no message)[32m 0[2mms[22m[39m
       [32mâœ“[39m should return 401 if unauthorized in getPlants[32m 0[2mms[22m[39m
       [32mâœ“[39m should handle generic error in getPlants[32m 0[2mms[22m[39m
       [32mâœ“[39m should return 200 and weather data[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should handle use case failure without statusCode (default 500)[39m[32m 93[2mms[22m[39m
       [32mâœ“[39m should return 401 if unauthorized in getWeather[32m 4[2mms[22m[39m
       [32mâœ“[39m should return 400 if gardenId is missing or invalid[32m 4[2mms[22m[39m
       [32mâœ“[39m should handle use case failure in getWeather[32m 0[2mms[22m[39m
       [32mâœ“[39m should handle generic error in getWeather[32m 1[2mms[22m[39m
       [32mâœ“[39m should return 200 and nearby gardens[32m 4[2mms[22m[39m
       [32mâœ“[39m should return 401 if unauthorized in getNearby[32m 1[2mms[22m[39m
       [32mâœ“[39m should return 400 if lat/lng is invalid[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle use case failure using statusCode from error[32m 0[2mms[22m[39m
       [32mâœ“[39m should return 400 if lat/lng are missing[32m 0[2mms[22m[39m
       [32mâœ“[39m should handle generic error in getNearby[32m 0[2mms[22m[39m
[90mstdout[2m | tests/domain/services/password.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

 [32mâœ“[39m tests/domain/services/password.service.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 1043[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return false for an incorrect password [33m 415[2mms[22m[39m
[90mstdout[2m | tests/integration/dr-plant.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mâœ“[39m tests/integration/dr-plant.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 50[2mms[22m[39m
[90mstdout[2m | tests/integration/plant.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

 [32mâœ“[39m tests/integration/plant.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 13[2mms[22m[39m
[90mstdout[2m | tests/integration/garden.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

 [32mâœ“[39m tests/integration/garden.routes.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 33[2mms[22m[39m
[90mstdout[2m | tests/integration/nearby-gardens.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

 [32mâœ“[39m tests/integration/nearby-gardens.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 12[2mms[22m[39m
[90mstdout[2m | tests/integration/dr-plant.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

 [32mâœ“[39m tests/integration/dr-plant.integration.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 22[2mms[22m[39m
[90mstdout[2m | infrastructure/http/routes/plant-id.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

 [32mâœ“[39m infrastructure/http/routes/plant-id.routes.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 94[2mms[22m[39m
[90mstdout[2m | tests/middleware/compression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

 [32mâœ“[39m tests/middleware/compression.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 24[2mms[22m[39m
[90mstdout[2m | tests/auth.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

 [32mâœ“[39m tests/auth.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 39[2mms[22m[39m
[90mstdout[2m | tests/websocket/weather.handler.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/websocket/weather.handler.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 61[2mms[22m[39m
[90mstdout[2m | tests/websocket/care-reminder.handler.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

 [32mâœ“[39m tests/websocket/care-reminder.handler.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 42[2mms[22m[39m
[90mstdout[2m | tests/application/services/TokenService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

 [32mâœ“[39m tests/application/services/TokenService.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 6[2mms[22m[39m
[90mstdout[2m | tests/adapters/gemini-plant.adapter.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

 [32mâœ“[39m tests/adapters/gemini-plant.adapter.test.ts [2m([22m[2m33 tests[22m[2m)[22m[32m 11[2mms[22m[39m
[90mstdout[2m | tests/middleware/auth.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1766359821189,"err":{"type":"Object","message":"Invalid token","stack":""},"msg":"Auth failed"}
{"level":30,"time":1766359821191,"userId":"new-db-id","msg":"Synced new user"}
{"level":30,"time":1766359821193,"userId":"id","msg":"Synced new user"}
{"level":50,"time":1766359821193,"err":{"type":"Error","message":"Supabase URL or Publishable Key not configured","stack":"Error: Supabase URL or Publishable Key not configured\n    at getSupabase (/Users/samueldulex/git/archiOweb-api/infrastructure/http/middleware/auth.middleware.ts:11:11)\n    at Module.<anonymous> (/Users/samueldulex/git/archiOweb-api/infrastructure/http/middleware/auth.middleware.ts:38:22)\n    at /Users/samueldulex/git/archiOweb-api/tests/middleware/auth.middleware.test.ts:147:27\n    at file:///Users/samueldulex/git/archiOweb-api/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///Users/samueldulex/git/archiOweb-api/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///Users/samueldulex/git/archiOweb-api/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///Users/samueldulex/git/archiOweb-api/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///Users/samueldulex/git/archiOweb-api/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///Users/samueldulex/git/archiOweb-api/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)"},"msg":"AuthMiddleware Error"}
{"level":50,"time":1766359821218,"err":{"type":"Error","message":"Database connection not initialized","stack":"Error: Database connection not initialized\n    at /Users/samueldulex/git/archiOweb-api/infrastructure/http/middleware/auth.middleware.ts:59:13\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at /Users/samueldulex/git/archiOweb-api/tests/middleware/auth.middleware.test.ts:172:21\n    at file:///Users/samueldulex/git/archiOweb-api/node_modules/@vitest/runner/dist/index.js:915:20"},"msg":"AuthMiddleware Error"}
{"level":50,"time":1766359821219,"err":"String Error","msg":"AuthMiddleware Error"}
 [32mâœ“[39m tests/middleware/auth.middleware.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 34[2mms[22m[39m
[90mstdout[2m | tests/controllers/plant-id.controller.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mâœ“[39m tests/controllers/plant-id.controller.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 6[2mms[22m[39m
[90mstdout[2m | tests/controllers/dr-plant.controller.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

 [32mâœ“[39m tests/controllers/dr-plant.controller.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 8[2mms[22m[39m
[90mstdout[2m | tests/repositories/plant-prisma.repository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

 [32mâœ“[39m tests/repositories/plant-prisma.repository.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 6[2mms[22m[39m
[90mstdout[2m | tests/use-cases/identify-species.use-case.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

 [32mâœ“[39m tests/use-cases/identify-species.use-case.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 4[2mms[22m[39m
[90mstdout[2m | tests/adapters/open-meteo.adapter.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

 [32mâœ“[39m tests/adapters/open-meteo.adapter.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 10[2mms[22m[39m
[90mstdout[2m | tests/repositories/user-prisma.repository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

 [32mâœ“[39m tests/repositories/user-prisma.repository.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 8[2mms[22m[39m
[90mstdout[2m | tests/use-cases/add-plant.use-case.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

 [32mâœ“[39m tests/use-cases/add-plant.use-case.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 7[2mms[22m[39m
[90mstdout[2m | tests/domain/plant.entity.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

 [32mâœ“[39m tests/domain/plant.entity.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 10[2mms[22m[39m
[90mstdout[2m | tests/middleware/rate-limit.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/middleware/rate-limit.middleware.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 7[2mms[22m[39m
[90mstdout[2m | tests/repositories/garden-prisma.repository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

 [32mâœ“[39m tests/repositories/garden-prisma.repository.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 21[2mms[22m[39m
[90mstdout[2m | tests/use-cases/find-nearby-gardens.use-case.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

 [32mâœ“[39m tests/use-cases/find-nearby-gardens.use-case.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 5[2mms[22m[39m
[90mstdout[2m | tests/domain/care-schedule.entity.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mâœ“[39m tests/domain/care-schedule.entity.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 5[2mms[22m[39m
[90mstdout[2m | tests/shared/utils/date.utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mâœ“[39m tests/shared/utils/date.utils.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 4[2mms[22m[39m
[90mstdout[2m | tests/middleware/error-handler.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

{"level":50,"time":1766359824757,"env":"production","err":{"type":"Error","message":"Secret error","stack":"Error: Secret error\n    at /Users/samueldulex/git/archiOweb-api/tests/middleware/error-handler.middleware.test.ts:50:17\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at file:///Users/samueldulex/git/archiOweb-api/node_modules/@vitest/runner/dist/index.js:915:20"},"msg":"Unhandled error"}
 [32mâœ“[39m tests/middleware/error-handler.middleware.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 54[2mms[22m[39m
[90mstdout[2m | tests/use-cases/diagnose-plant.use-case.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mâœ“[39m tests/use-cases/diagnose-plant.use-case.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 6[2mms[22m[39m
[90mstdout[2m | tests/use-cases/get-user-plants.use-case.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

 [32mâœ“[39m tests/use-cases/get-user-plants.use-case.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 5[2mms[22m[39m
[90mstdout[2m | tests/use-cases/get-garden-weather.use-case.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/use-cases/get-garden-weather.use-case.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/domain/diagnosis.entity.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

 [32mâœ“[39m tests/domain/diagnosis.entity.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 4[2mms[22m[39m
[90mstdout[2m | tests/controllers/user.controller.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

 [32mâœ“[39m tests/controllers/user.controller.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 6[2mms[22m[39m
[90mstdout[2m | tests/domain/garden.entity.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/domain/garden.entity.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 5[2mms[22m[39m
[90mstdout[2m | tests/domain/user.entity.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mâœ“[39m tests/domain/user.entity.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 3[2mms[22m[39m
[90mstdout[2m | tests/shared/utils/ssrf.validator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

 [32mâœ“[39m tests/shared/utils/ssrf.validator.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 4[2mms[22m[39m
[90mstdout[2m | tests/domain/species.entity.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

 [32mâœ“[39m tests/domain/species.entity.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/domain/services/authorization.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/domain/services/authorization.service.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 4[2mms[22m[39m
[90mstdout[2m | tests/middleware/logger.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

 [32mâœ“[39m tests/middleware/logger.middleware.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 65[2mms[22m[39m
[90mstdout[2m | tests/middleware/validation.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/middleware/validation.middleware.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 30[2mms[22m[39m
[90mstdout[2m | tests/infrastructure/config/logger.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

 [32mâœ“[39m tests/infrastructure/config/logger.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 48[2mms[22m[39m
[90mstdout[2m | tests/domain/value-objects/geo-location.vo.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

 [32mâœ“[39m tests/domain/value-objects/geo-location.vo.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/shared/utils/geo.utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/shared/utils/geo.utils.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 10[2mms[22m[39m
[90mstdout[2m | tests/domain/value-objects/email.vo.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

 [32mâœ“[39m tests/domain/value-objects/email.vo.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 3[2mms[22m[39m
[90mstdout[2m | tests/controllers/plant.controller.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

 [32mâœ“[39m tests/controllers/plant.controller.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 3[2mms[22m[39m
[90mstdout[2m | tests/controllers/care-tracker.controller.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

 [32mâœ“[39m tests/controllers/care-tracker.controller.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/shared/errors/app-error.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

 [32mâœ“[39m tests/shared/errors/app-error.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 12[2mms[22m[39m
[90mstdout[2m | tests/controllers/auth.controller.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

 [32mâœ“[39m tests/controllers/auth.controller.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 3[2mms[22m[39m
[90mstdout[2m | tests/domain/value-objects/plant-exposure.vo.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mâœ“[39m tests/domain/value-objects/plant-exposure.vo.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/domain/value-objects/password.vo.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

 [32mâœ“[39m tests/domain/value-objects/password.vo.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 3[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 8 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m tests/controllers/garden.controller.test.ts[2m > [22mGardenController[2m > [22mgetWeather[2m > [22mshould handle use case failure without statusCode (default 500)
[31m[1mAssertionError[22m: expected 400 to be 500 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 500[39m
[31m+ 400[39m

[36m [2mâ¯[22m tests/controllers/garden.controller.test.ts:[2m157:29[22m[39m
    [90m155| [39m      mockGetWeather.execute.mockResolvedValue(fail({ code: 'ERR', mesâ€¦
    [90m156| [39m      [35mconst[39m result [33m=[39m ([35mawait[39m controller[33m.[39m[34mgetWeather[39m(mockContext)) [35mas[39m any
    [90m157| [39m      [34mexpect[39m(result[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m500[39m)
    [90m   | [39m                            [31m^[39m
    [90m158| [39m    })
    [90m159| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/8]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/e2e/garden.e2e.test.ts[2m > [22mE2E: Garden Management[2m > [22mGET /api/v2/gardens/:gardenId/weather[2m > [22mshould return weather for garden location
[31m[1mAssertionError[22m: expected [ 200, 500 ] to include 400[39m
[36m [2mâ¯[22m tests/e2e/garden.e2e.test.ts:[2m155:26[22m[39m
    [90m153| [39m
    [90m154| [39m      // Weather API might succeed or fail depending on external serviâ€¦
    [90m155| [39m      [34mexpect[39m([[34m200[39m[33m,[39m [34m500[39m])[33m.[39m[34mtoContain[39m(res[33m.[39mstatus)
    [90m   | [39m                         [31m^[39m
    [90m156| [39m      [35mif[39m (res[33m.[39mstatus [33m===[39m [34m200[39m) {
    [90m157| [39m        [34mexpect[39m(res[33m.[39mbody[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/8]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/e2e/garden.e2e.test.ts[2m > [22mE2E: Garden Management[2m > [22mGET /api/v2/gardens/:gardenId/weather[2m > [22mshould return 404 for non-existent garden
[31m[1mAssertionError[22m: expected 400 to be 404 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 404[39m
[31m+ 400[39m

[36m [2mâ¯[22m tests/e2e/garden.e2e.test.ts:[2m173:26[22m[39m
    [90m171| [39m        [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m'Bearer valid-token'[39m)
    [90m172| [39m
    [90m173| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m404[39m)
    [90m   | [39m                         [31m^[39m
    [90m174| [39m    })
    [90m175| [39m  })

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/8]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/user-profile.test.ts[2m > [22mUser Public Profile Integration[2m > [22mshould return public profile for existing user
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 400[39m

[36m [2mâ¯[22m tests/integration/user-profile.test.ts:[2m95:24[22m[39m
    [90m 93| [39m    })
    [90m 94| [39m
    [90m 95| [39m    [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)
    [90m   | [39m                       [31m^[39m
    [90m 96| [39m    [35mconst[39m json [33m=[39m [35mawait[39m res[33m.[39m[34mjson[39m()
    [90m 97| [39m    [34mexpect[39m(json[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/8]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/user-profile.test.ts[2m > [22mUser Public Profile Integration[2m > [22mshould return 404 for non-existent user
[31m[1mAssertionError[22m: expected 400 to be 404 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 404[39m
[31m+ 400[39m

[36m [2mâ¯[22m tests/integration/user-profile.test.ts:[2m130:24[22m[39m
    [90m128| [39m    })
    [90m129| [39m
    [90m130| [39m    [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m404[39m)
    [90m   | [39m                       [31m^[39m
    [90m131| [39m    [35mconst[39m json [33m=[39m [35mawait[39m res[33m.[39m[34mjson[39m()
    [90m132| [39m    [34mexpect[39m(json[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/8]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/user-profile.test.ts[2m > [22mUser Public Profile Integration[2m > [22mshould return null for avatarUrl if not set
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 400[39m

[36m [2mâ¯[22m tests/integration/user-profile.test.ts:[2m170:24[22m[39m
    [90m168| [39m    })
    [90m169| [39m
    [90m170| [39m    [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)
    [90m   | [39m                       [31m^[39m
    [90m171| [39m    [35mconst[39m json [33m=[39m [35mawait[39m res[33m.[39m[34mjson[39m()
    [90m172| [39m    [34mexpect[39m(json[33m.[39mdata[33m.[39mavatarUrl)[33m.[39m[34mtoBe[39m([35mnull[39m)

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/8]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/weather.test.ts[2m > [22mWeather Integration[2m > [22mshould return weather data for valid garden
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 400[39m

[36m [2mâ¯[22m tests/integration/weather.test.ts:[2m112:24[22m[39m
    [90m110| [39m    })
    [90m111| [39m
    [90m112| [39m    [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)
    [90m   | [39m                       [31m^[39m
    [90m113| [39m    [35mconst[39m json [33m=[39m [35mawait[39m res[33m.[39m[34mjson[39m()
    [90m114| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/8]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/weather.test.ts[2m > [22mWeather Integration[2m > [22mshould return 400 for invalid garden ID format
[31m[1mAssertionError[22m: expected 400 to be 404 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 404[39m
[31m+ 400[39m

[36m [2mâ¯[22m tests/integration/weather.test.ts:[2m140:24[22m[39m
    [90m138| [39m
    [90m139| [39m    [90m// Should fail and return 404[39m
    [90m140| [39m    [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m404[39m)
    [90m   | [39m                       [31m^[39m
    [90m141| [39m  })
    [90m142| [39m})

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/8]â¯[22m[39m


[2m Test Files [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m53 passed[39m[22m[90m (57)[39m
[2m      Tests [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m379 passed[39m[22m[90m (387)[39m
[2m   Start at [22m 18:30:09
[2m   Duration [22m 21.28s[2m (transform 1.21s, setup 1.63s, import 7.36s, tests 2.33s, environment 7ms)[22m

